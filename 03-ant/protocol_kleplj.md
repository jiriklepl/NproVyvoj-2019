Jiří Klepl
jiriklepl@seznam.cz

Deadline: 31.10.2019 / 1.11.2019

Requirements:
- You do not have to procotol absolutely everything, such as 'cd' commands,
  'rm -rf' when the task tells you to do a 'rm -rf', 'vim file', etc.
- Include output of commands only when explicitly requested.
- You can write answers in Czech.

Useful links and help:
  http://ant.apache.org/manual/index.html


-----
Tasks
-----

0. The "ftp" directory contains two subdirectories: "src" with the sources of a very simple
   FTP server and "lib" with few JAR files representing external dependencies (libraries).
   The main class is "org.apache.ftpserver.commandline.CommandLine".

1. Write a build script for the FTP server - the file "ftp/build.xml".

   - Respect the common directory layout:
         src -> source files (.java)
         build -> class files
         lib -> third-party dependencies, libraries
   
   - The build script must define the following targets: clean, build, dist, run.

   - Specify classpaths using "filesets". All jar files in the "lib" directory
     must be included. However, do not enumerate individual jar files.
     (Hint: use wildcards properly)

```xml
<path id="FTPServer.classpath">
    <pathelement path="${java.class.path}"/>
    <fileset dir="${lib.dir}">
        <include name="**/*.jar"/>
    </fileset>
</path>
```

   - Use properties for directory names (paths).

```xml
<property name="dist.name" value="ftpserver"/>

<property name="src.dir" value="./src"/>
<property name="build.dir" value="./build"/>
<property name="lib.dir" value="./lib"/>
<property name="dist.dir" value="./dist"/>
```

   - Specify reasonable dependencies between targets.

```xml
<!-- Creates the build dir -->
<target name="init">

<!-- Creates the dist dir -->
<target name="initdist">

<!-- Compiles the code, the dir has to exist -->
<target name="compile" depends="init">

<!-- Creates the java archive, code has to be compiled
     and the dir has to exist -->
<target name="dist" depends="compile, initdist">

<!-- Runs the archive, it has to be distributed -->
<target name="run" depends="dist">
```

   - The JAR file generated by the target "dist" must contain:
       - all class files generated by the Java compiler

       - manifest file with the attributes "Project" (use the value "FTP")
         and "BuildDate" (use the current date)

```xml
<!-- in the dist target -->
<jar destfile="${dist.dir}/${dist.name}-${DSTAMP}.jar"
      basedir="${build.dir}">
    <manifest>
        <attribute name="Main-Class" 
                   value="org.apache.ftpserver.commandline.CommandLine"/>
        <attribute name="Project" value="FTP"/>
        <attribute name="BuildDate" value="${DSTAMP}"/>
    </manifest>
</jar>
```

   - Name of the JAR files must reflect the current date (e.g., "ftpserver-YYYYMMDD.jar").

SEE previous exercise

   - The "clean" target must remove the directory with class files and the JAR file.

```xml
<target name="clean">
    <!-- Contains the class files -->
    <delete dir="${build.dir}"/>

    <!-- Contains the jar and zip files,
         could remove just jar, but this is more manageable -->
    <delete dir="${dist.dir}"/>
</target>
```

   - The "run" target should execute the compiled program such that its output is 
     redirected into a file specified inside the build script.

```xml
<target name="run" depends="dist">
    <available property="jar.exists"
               file="${dist.dir}/${dist.name}-${DSTAMP}.jar"/>
    <fail unless="jar.exists">The archive is not up-to-date</fail>

    <java jar="${dist.dir}/${dist.name}-${DSTAMP}.jar"
          fork="true"
          output="output.out"/>
</target>
```

   - The "run" target should, before attempting to execute the program, check presence of the JAR file and whether the JAR file is up-to-date.
     If the JAR file does not exist, or when it is obsolete, then print some message and fail graciously.

SEE previous exercise

   - The "dist" target should also create a zip file that contains all the source files (and only them).

```xml
<!-- in the dist target -->
<zip basedir="${src.dir}"
     destfile="${dist.dir}/sources.zip"/>
```

   - The default target should be "build".

```xml
<project name="FTPServer" default="build" basedir=".">
```

2. Test the build script by executing "ant clean" followed by "ant dist".
   Paste the output of Ant here.

```txt
$ ant clean
Buildfile: /mnt/c/Users/Jirka/Documents/School/BC3/NastrojePVS/03-ant/ftp/build.xml

clean:
   [delete] Deleting directory /mnt/c/Users/Jirka/Documents/School/BC3/NastrojePVS/03-ant/ftp/build
   [delete] Deleting directory /mnt/c/Users/Jirka/Documents/School/BC3/NastrojePVS/03-ant/ftp/dist

BUILD SUCCESSFUL
Total time: 0 seconds
```

```txt
$ ant run
Buildfile: /mnt/c/Users/Jirka/Documents/School/BC3/NastrojePVS/03-ant/ftp/build.xml

init:
    [mkdir] Created dir: /mnt/c/Users/Jirka/Documents/School/BC3/NastrojePVS/03-ant/ftp/build

compile:
    [javac] Compiling 139 source files to /mnt/c/Users/Jirka/Documents/School/BC3/NastrojePVS/03-ant/ftp/build
    [javac] Note: Some input files use or override a deprecated API.
    [javac] Note: Recompile with -Xlint:deprecation for details.
    [javac] Note: Some input files use unchecked or unsafe operations.
    [javac] Note: Recompile with -Xlint:unchecked for details.

initdist:

dist:
      [jar] Building jar: /mnt/c/Users/Jirka/Documents/School/BC3/NastrojePVS/03-ant/ftp/dist/ftpserver-20191027.jar
      [zip] Building zip: /mnt/c/Users/Jirka/Documents/School/BC3/NastrojePVS/03-ant/ftp/dist/sources.zip

run:

BUILD SUCCESSFUL
Total time: 4 seconds
```

3. Send the build.xml file along with the protocol.


-------
Anketa:
-------

Anketa slouzi pro zhodnoceni temat cviceni a domacich uloh. 
Vyplneni je dobrovolne, nicmene vhodne k budoucimu ladeni obsahu a narocnosti cviceni. 
Na vetsinu otazek je mozna odpoved od 1 do 10, odpoved piste pod prislusnou otazku. 

(1) Nakolik nove pro vas bylo tema cviceni?
    (1 - zcela nove, 10 - vse jsem jiz znal)

2

(2) Domnivate se, ze bylo tema cviceni uzitecne?
    (1 - neuzitecne ci prilis trivialni, 10 - velmi uzitecne)

9

(3) Jak hodnotite narocnost domaci ulohy?
    (1 - prilis trivialni, 5-6 - akorat, 10 - prilis narocne)

5

(4) Jak hodnotite svoje zkusenosti s nastrojem ve srovnani s domaci ulohou?
    (1 - vsechno uz znam a umim pouzivat, 10 - vsechno jsem si prakticky vyzkousel poprve)

10

(5) Kolik casu (v minutach) vam reseni zhruba zabralo?

40 (vcetne vseho okolo)

(6) Prostor pro vlastni komentare ke cviceni a domaci uloze:

Mam jiz nejake zkusenosti s make, takze velice zajimava zkusennost s nastrojem, ktery k podobne veci pristupuje z trochu jineho uhlu.